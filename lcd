#!/usr/bin/zsh
LCD=/dev/ttyUSB0

function init() {
	echo "\xA0" > $LCD
}

function gotoxy() {
	echo "\xA1\x$1\x$2" > $LCD
}

function print() {
	echo $1 > $LCD
}

function lcdon() {
	echo "\xA5\x01" > $LCD
	echo "Display on"
}

function lcdoff() {
	echo "\xA5\x02" > $LCD
	echo "Display off"
}
function temp() {
#	sed "s/\(..\)\(.\).*/\1.\2 C/" < /sys/class/thermal/thermal_zone0/temp > $LCD
	sensors | grep -E "^(CPU Temp|Core 0)" | awk '{print $3}'  > $LCD
}

function uptime() {
	uptime -s | awk "{print $2}" > $LCD
	# uptime -s > $LCD
}

function cursoron() {
	echo "\xA3\x0E" > $LCD
}

function cursoroff() {
	echo "\xA3\x0C" > $LCD
}

function degre() {
	echo "\xDF" > $LCD
}
function loop() {
	./lcd clear
	./lcd print "CPU:"
	./lcd xy 0 1
	# ./lcd print "Uptime:"
	while [[ 1 ]]; do
		./lcd xy 8 0 temp
		# ./lcd xy 8 1 uptime
		sleep 3
	done
}

#main
case $1 in
	off)
		lcdoff
	;;
	on)
		lcdon
	;;
	cls | clear)
		init
		cursoroff
	;;
	xy)
		gotoxy $2 $3
		if [[ $4 == "temp" ]]; then
			temp
		elif [[ $4 == "uptime" ]]; then
			uptime
		fi
	;;
	print)
	  print $2
	;;
	temp)
		temp
	;;
	cursoroff)
		cursoroff
	;;
	cursoron)
		cursoron
	;;
	uptime)
	  uptime
	;;
	loop)
	  loop
	;;
esac
#else
#	echo "Display not found"
#fi
